## 1.ä»å‰ç«¯ç»„ä»¶åŒ–å¼€å§‹
å¯¹äºè®¸å¤šéœ€æ±‚,æˆ‘ä»¬éœ€è¦å¯å¤ç”¨çš„åŠŸèƒ½æ¨¡å—.  
ç°åœ¨,æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€å•çš„ç‚¹èµåŠŸèƒ½:
```
<!--html-->
<div class='wrapper'>
    <button class='like-btn'>
    <span class='like-text'>ç‚¹èµ</span>
    <span>ğŸ‘</span>
    </button>
</div>

<!--js-->
<script>
    const BTN = document.querySelector('.like-btn');
    const BTNTEXT = document.querySelector('.like-text');
    let btnType = true;
    BTN.addEventListener('click',()=>{
        if(btnType){
            BTNTEXT.innerText = 'å–æ¶ˆ';
        }else{
            BTNTEXT.innerText = 'ç‚¹èµ';
        }
        btnType = !btnType;
    },false);
</script>
```  
è¿™æ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„åŠŸèƒ½,ä½†æ˜¯å¦‚æœæˆ‘ä»¬æƒ³è¦å»å¤ç”¨è¿™ä¸ªåŠŸèƒ½,é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦æŠŠä»¥ä¸Šçš„HTMLå’ŒJSéƒ½å¤åˆ¶è¿‡æ¥,åŠŸèƒ½æ¯”è¾ƒç®€å•çš„ä¸œè¥¿è¿˜å¯ä»¥,ä½†æ˜¯åŠŸèƒ½å¤æ‚çš„å†…å®¹å°±ææ€–äº†.  
äºæ˜¯æˆ‘ä»¬æƒ³å‡ºæ¥ä¸€ç§æ–¹æ³•:JSç›´æ¥è¾“å‡ºHTML!  
```
<!--html-->
<div class='warpper'>

</div>

<!--js-->
<script>

    class LinkBtn{
        constructor(){

        }
        renderHtml(){
            let template = `<button class='like-btn'>
                                <span class='like-text'>ç‚¹èµ</span>
                                <span>ğŸ‘</span>
                            </button>`;
            return template;
        }
    }
    const WARPPER = document.querySelector('.warpper');
    WARPPER.innerHTML += new LinkBtn().renderHtml();
    WARPPER.innerHTML += new LinkBtn().renderHtml();
</script>
```
äºæ˜¯æˆ‘ä»¬å°±è¿™æ ·æš´åŠ›çš„å®ç°äº†HTMLçš„å¤ç”¨,ä½†æ˜¯ç°åœ¨è¿™ä¸ªæŒ‰é’®,æ ¹æœ¬æ²¡æœ‰ä»»ä½•æ•ˆæœ.æˆ‘ä»¬æ²¡æœ‰æ·»åŠ ä»»ä½•äº‹ä»¶. è¿™æ€ä¹ˆåŠ? LikeButton ç±»é‡Œé¢æ˜¯è™½ç„¶è¯´æœ‰ä¸€ä¸ª buttonï¼Œä½†æ˜¯è¿™ç©æ„æ ¹æœ¬å°±æ˜¯åœ¨å­—ç¬¦ä¸²é‡Œé¢çš„ã€‚ä½ æ€ä¹ˆèƒ½å¾€ä¸€ä¸ªå­—ç¬¦ä¸²é‡Œé¢æ·»åŠ äº‹ä»¶å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦è¿™ä¸ªDOMç»“æ„å•Š!  

é‚£ä¹ˆæˆ‘ä»¬å°±åˆ›å»ºä¸€ä¸ªcreateElementæ–¹æ³•å§,è®©å®ƒæ¥è¿”å›ä¸€ä¸ªDOMç»“æ„,æˆ‘ä»¬ä¸å°±æœ‰è¿™ä¸ªbuttonçš„DOMç»“æ„äº†ä¹ˆ?
```
æˆ‘ä»¬éœ€è¦è¿™æ ·ä¸€ä¸ªå‡½æ•°:
//String => DOM Element
const createDOMFromString = (domString) => {
  // TODO 
}
```

ä½†æ˜¯è¯•äº†å¾ˆå¤šç§æ–¹æ³•å»å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºdomå¯¹è±¡,ç»“æœæ²¡æœ‰å¾ˆå¥½çš„åŠæ³•,äºæ˜¯é‡‡ç”¨äº†è¿™ç§å¥‡æ€ªçš„åŠæ³•:

```
class LinkBtn {
    constructor() {

    }
    renderHtml() {
        this.el = createDOMFromString( `
                <button class='like-button'>
                    <span class='like-text'>ç‚¹èµ</span>
                    <span>ğŸ‘</span>
                </button>`);
        this.el.addEventListener('click', () => console.log('click'), false)
        return this.el
    }
}
function createDOMFromString(string){
    if(Object.prototype.toString.call(string) === '[object String]'){
        let div = document.createElement('div');
        div.innerHTML = string;
        return div;
    }
}
const WARPPER = document.querySelector('.warpper');
WARPPER.appendChild(new LinkBtn().renderHtml());
WARPPER.appendChild(new LinkBtn().renderHtml());
```

æ¥ä¸‹æ¥,æ·»åŠ ç‚¹å‡»äº‹ä»¶å’¯  

```
<body>
    <!--html-->
    <div class='warpper'>

    </div>

    <!--js-->
    <script>
        class LinkBtn {
            constructor() {
                this.el = null;
                this.status = {
                    isLike:false
                }
            }
            renderHtml() {
                this.el = createDOMFromString( `
                        <button class='like-button'>
                            <span class='like-text'>ç‚¹èµ</span>
                            <span>ğŸ‘</span>
                        </button>`);
                this.el.addEventListener('click', this.eventClick.bind(this), false)
                return this.el
            }
            eventClick(){
                console.log(this);
                let likeText = this.status.isLike ? 'å–œæ¬¢':'ä¸å–œæ¬¢';
                this.el.querySelector('.like-text').innerText = likeText;
                this.status.isLike = !this.status.isLike;
            }
        }
        function createDOMFromString(string){
            if(Object.prototype.toString.call(string) === '[object String]'){
                let div = document.createElement('div');
                div.innerHTML = string;
                return div;
            }
        }
        const WARPPER = document.querySelector('.warpper');
        WARPPER.appendChild(new LinkBtn().renderHtml());
        WARPPER.appendChild(new LinkBtn().renderHtml());
    </script>
</body>


```
æ”¹é€ å®Œæˆ,è¿™å°±æ˜¯ä¸€ä¸ªç®€å•çš„å°ç»„ä»¶.    

## 2.ä¼˜åŒ–DOM  
ä¸€ä¸ªç»„ä»¶çš„æ˜¾ç¤ºå½¢æ€ç”±å¤šä¸ªçŠ¶æ€å†³å®šçš„æƒ…å†µéå¸¸å¸¸è§ã€‚ä»£ç ä¸­æ··æ‚ç€å¯¹ DOM çš„æ“ä½œå…¶å®æ˜¯ä¸€ç§ä¸å¥½çš„å®è·µï¼Œæ‰‹åŠ¨ç®¡ç†æ•°æ®å’Œ DOM ä¹‹é—´çš„å…³ç³»ä¼šå¯¼è‡´ä»£ç å¯ç»´æŠ¤æ€§å˜å·®ã€å®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥æˆ‘ä»¬çš„ä¾‹å­è¿™é‡Œè¿˜æœ‰ä¼˜åŒ–çš„ç©ºé—´ï¼šå¦‚ä½•å°½é‡å‡å°‘è¿™ç§æ‰‹åŠ¨ DOM æ“ä½œï¼Ÿ  
è§£å†³åŠæ³•æ˜¯:  **ä¸€æ—¦çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œå°±é‡æ–°è°ƒç”¨ render æ–¹æ³•ï¼Œæ„å»ºä¸€ä¸ªæ–°çš„ DOM å…ƒç´ ã€‚**  

è¿™æ ·åšçš„å¥½å¤„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¥½å¤„å°±æ˜¯ä½ å¯ä»¥åœ¨ render æ–¹æ³•é‡Œé¢ä½¿ç”¨æœ€æ–°çš„ this.state æ¥æ„é€ ä¸åŒ HTML ç»“æ„çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”é€šè¿‡è¿™ä¸ªå­—ç¬¦ä¸²æ„é€ ä¸åŒçš„ DOM å…ƒç´ ã€‚é¡µé¢å°±æ›´æ–°äº†.  

```
<!--html-->
<div class='warpper'>

</div>

<!--js-->
<script>
    class LinkBtn {
        constructor() {
            this.el = null;
            this.state = {
                isLike: false
            }
        }
        setState(state) {
            this.state = state;
            this.el = this.renderHtml();
        }
        renderHtml() {
            this.el = createDOMFromString.call(this,
                `
    <button class='like-btn'>
        <span class='like-text'>${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}</span>
        <span>ğŸ‘</span>
    </button>
    `
            );
            this.el.addEventListener('click', this.eventClick.bind(this), false)
            return this.el
        }
        eventClick() {
            this.setState({
                isLiked: !this.state.isLike
            })
        }
    }

    function createDOMFromString(string) {
        if (Object.prototype.toString.call(string) === '[object String]') {
            let div = document.createElement('div');
            div.innerHTML = string;
            return div;
        }
    }
    const WARPPER = document.querySelector('.warpper');
   WARPPER.appendChild(new LinkBtn().renderHtml());
```

eventClick éƒ½ä¼šè°ƒç”¨æ”¹å˜ç»„ä»¶çŠ¶æ€ç„¶åè°ƒç”¨ setState ï¼›setState ä¼šè°ƒç”¨ renderHtml renderHtml æ–¹æ³•ä¼šæ ¹æ® state çš„ä¸åŒé‡æ–°æ„å»ºä¸åŒçš„ DOM å…ƒç´ .    
å®é™…ä¸Šä¸Šé¢çš„æ”¹è¿›æœ‰å¾ˆå¤§çš„é—®é¢˜,å› ä¸ºæ¯æ¬¡ç‚¹å‡»é‡æ–°æ’å…¥äº†ä¸€ä¸ªDOMèŠ‚ç‚¹,æˆ‘ä»¬åº”è¯¥å¹²æ‰æ—§çš„èŠ‚ç‚¹ç´ ç„¶åæ’å…¥æ–°çš„èŠ‚ç‚¹  
```
setState (state) {
    const oldEl = this.el
    this.state = state
    this.el = this.render()
    if (this.onStateChange) this.onStateChange(oldEl, this.el)
}
```
ä½¿ç”¨çš„æ—¶å€™  

```
const likeButton = new LikeButton()
wrapper.appendChild(likeButton.render()) // ç¬¬ä¸€æ¬¡æ’å…¥ DOM å…ƒç´ 
component.onStateChange = (oldEl, newEl) => {
  wrapper.insertBefore(newEl, oldEl) // æ’å…¥æ–°çš„å…ƒç´ 
  wrapper.removeChild(oldEl) // åˆ é™¤æ—§çš„å…ƒç´ 
} 
```
è¿™é‡Œæ¯æ¬¡ setState éƒ½ä¼šè°ƒç”¨ onStateChange æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•æ˜¯å®ä¾‹åŒ–ä»¥åæ—¶å€™è¢«è®¾ç½®çš„ï¼Œæ‰€ä»¥ä½ å¯ä»¥è‡ªå®šä¹‰ onStateChange çš„è¡Œä¸ºã€‚è¿™é‡Œåšçš„äº‹æ˜¯ï¼Œæ¯å½“ setState ä¸­æ„é€ å®Œæ–°çš„ DOM å…ƒç´ ä»¥åï¼Œå°±ä¼šé€šè¿‡ onStateChange å‘ŠçŸ¥å¤–éƒ¨æ’å…¥æ–°çš„ DOM å…ƒç´ ï¼Œç„¶ååˆ é™¤æ—§çš„å…ƒç´ ï¼Œé¡µé¢å°±æ›´æ–°äº†ã€‚è¿™é‡Œå·²ç»åšåˆ°äº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–äº†ï¼šç°åœ¨ä¸éœ€è¦å†æ‰‹åŠ¨æ›´æ–°é¡µé¢äº†ã€‚  
éä¸€èˆ¬çš„æš´åŠ›ï¼Œå› ä¸ºæ¯æ¬¡ setState éƒ½é‡æ–°æ„é€ ã€æ–°å¢ã€åˆ é™¤ DOM å…ƒç´ ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨è¿›è¡Œå¤§é‡çš„é‡æ’ï¼Œä¸¥é‡å½±å“æ€§èƒ½ã€‚  

## æŠ½è±¡åŒ–ç»„ä»¶  
ä¸ºäº†è®©ä»£ç æ›´çµæ´»ï¼Œå¯ä»¥å†™æ›´å¤šçš„ç»„ä»¶ï¼Œæˆ‘ä»¬æŠŠè¿™ç§æ¨¡å¼æŠ½è±¡å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ª Component ç±»å½“ä¸­ï¼š  
```
 class Component {
    setState (state) {
      const oldEl = this.el
      this.state = state
      this.el = this._renderDOM()
      if (this.onStateChange) this.onStateChange(oldEl, this.el)
    }

    _renderDOM () {
      this.el = createDOMFromString(this.render())
      if (this.onClick) {
        this.el.addEventListener('click', this.onClick.bind(this), false)
      }
      return this.el
    }
  }
```

å†æ¥ä¸€ä¸ªmountæ–¹æ³•, æŠŠç»„ä»¶çš„ DOM å…ƒç´ æ’å…¥é¡µé¢ï¼Œå¹¶ä¸”åœ¨ setState çš„æ—¶å€™æ›´æ–°é¡µé¢  
```
const mount = (component, wrapper) => {
    wrapper.appendChild(component.renderDOM())
    component.onStateChange = (oldEl, newEl) => {
      wrapper.insertBefore(newEl, oldEl)
      wrapper.removeChild(oldEl)
    }
  }
```
äºæ˜¯ç‚¹èµæ’ä»¶å°±å˜æˆäº†è¿™ä¸ªæ ·å­:  
```
class LikeButton extends Component {<body>
    <div class='wrapper'></div>
  </body>

  <script type="text/javascript">
    /* Component */
    class Component {
      constructor (props = {}) {
        this.props = props
      }
      setState (state) {
        const oldEl = this.el
        this.state = state
        this.el = this.renderDOM()
        if (this.onStateChange) this.onStateChange(oldEl, this.el)
      }
      renderDOM () {
        this.el = createDOMFromString(this.render())
        if (this.onClick) {
          this.el.addEventListener('click', this.onClick.bind(this), false)
        }
        return this.el
      }
    }
    const createDOMFromString = (domString) => {
      const div = document.createElement('div')
      div.innerHTML = domString
      return div
    }
    const mount = (component, wrapper) => {
      wrapper.appendChild(component.renderDOM())
      component.onStateChange = (oldEl, newEl) => {
        wrapper.insertBefore(newEl, oldEl)
        wrapper.removeChild(oldEl)
      }
    }
    /* ========================================= */
    class LikeButton extends Component {
      constructor (props) {
        super(props)
        this.state = { isLiked: false }
      }
      onClick () {
        this.setState({
          isLiked: !this.state.isLiked
        })
      }
      render () {
        return `
          <button class='like-btn' style="background-color: ${this.props.bgColor}">
            <span class='like-text'>
              ${this.state.isLiked ? 'å–æ¶ˆ' : 'ç‚¹èµ'}
            </span>
            <span>ğŸ‘</span>
          </button>
        `
      }
    }
    class RedBlueButton extends Component {
      constructor (props) {
        super(props)
        this.state = {
          color: 'red'
        }
      }
      onClick () {
        this.setState({
          color: 'blue'
        })
      }
      render () {
        return `
          <div style='color: ${this.state.color};'>${this.state.color}</div>
        `
      }
    }
    const wrapper = document.querySelector('.wrapper')
    mount(new LikeButton({ bgColor: 'red' }), wrapper)
    mount(new LikeButton(), wrapper)
    mount(new RedBlueButton(), wrapper)
  </script>
```

